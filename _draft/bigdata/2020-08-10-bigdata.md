---
layout: post
title: "大规模分布式系统架构与实现-读书笔记"
tagline: ""
date: '2020-08-10 18:59:50 +0800'
category: bigdata
tags: 大数据 分布式
keywords: bigdata,大数据,分布式系统,大规模分布式系统架构与实现-读书笔记
description: bigdata,大规模分布式系统架构与实现-读书笔记
---
> 大规模分布式系统架构与实现-读书笔记
# 引言
本篇是《大规模分布式系统架构与实现》一书的读书笔记，该书基于fourinone框架阐述了分布式系统架构的概念和思想。
<!-- more -->

# 关于分布式的一些概念与产品
- 离线计算：它不是技术，也不是产品，而是一种分布式计算应用方式。Hadoop应用大部分都是离线计算，也就是数据通常保存在分布式文件系统中，在离线状态下去分析这些数据，类似离线状态的数据分析有很多，日志分析也属于一种离线计算，很多数据挖掘算法也基于离线计算，通常离线计算要分析的数据量大，一般采用并行计算的方式提高效率
- 实时计算：实时计算大多指一种增量计算，尽量让计算过程在短时间完成，而不是先导入多少数据到一个存储位置，然后再花费数个小时去分析这些数据，这是跟离线计算的本质区别，实时计算是增量性的，少量的，变化的，来了就能计算。实时计算也是一种分布式计算应用方式。
- 迭代计算：这种方式使用Hadoop的Map/Reduce并不好弄，它有个最大的区别，就是需要考虑阶段，上一阶段的结果作为下一阶段的条件，而且为了高效，最好将中间结果保存在内存，不要频繁读写文件，迭代计算在数据挖掘聚类算法、机器学习算法等等有很多应用，主要因为这些算法需要大量训练，逐渐靠近精确结果，所以中间结果会作为下一轮条件。
## Storm
Storm是Twitter开源的一款用于实时分析的软件，Storm核心的消息通信和分布式协调都是使用其他软件，它依赖Apache Zookeeper、JZMQ(ZeroMQ)。Storm流计算，主要是指增量数据通过消息分发，多个消息接收者并行接收处理这样一个机制。
## Spark
Spark是加州伯克利大学的学生作品，是一款基于内存的用于迭代计算的框架。Spark建立在mesos的资源调度框架上。Spark用比较少的Scala代码实现，跟Hadoop基于分布式文件IO操作方式不同，Spark尽可能利用内存去做迭代计算，并用mesos管理机器资源分配。
## MPI
MPI(Message Passing Interface)是消息传递并行程序设计的标准之一，它是一个规范或者是一个库，但是不包括实现，目前最新版本为MPI-2(1997年发布)，MPI能完成并行机的进程间通信，当前实现版本有MIPCH2和OPENMPI，目前广泛用于互联网企业的广告算法和迭代算法，阿里和国内其他大型互联网公司都有成百上千的MPI计算集群。
MPI定义了进程间的通信接口，比如：mpi_send和mpi_recv等两个进程间发送和接收消息的常用接口，由此可见，基于MPI可以利用多个进程并行作业和交互，相对于上面介绍的Hadoop、Storm等计算平台，MPI能实现更灵活的并行计算方式，MPI更接近开发工具包和开发规范。
## BSP
Apache发布的并行计算软件Hama牵扯出了BSP(Bulk Synchronous Paarallel)思想，Hama基于BSP实现了google的Pregel的思想，提供一个相对于Map/Reduce和MPI更灵活的计算模式，大致由并行进程、消息通信层、栅栏同步层组成，并划分成一系列的superstep。官方资料强调BSP相对于MPI更侧重解决通信密集型计算，并对计算过程用一些参数指标，比如：进程数、进出消息数、消息大小等等，试图估计出整个计算需要耗费的时间。BSP相对于MPI的优化主要还是设计模式上，通信接口等优化不了什么。提出一个栅栏的设计，其实就是划分阶段和环节，用于迭代类型。还有就是基于消息的进程间通信交互，用发布接收消息模式代替点对点通信。、
## DAG
DAG(有向无环图)，微软的分布式计算平台Dryad的总体构建用来支持DAG(Directed Acycline Graph)类型的数据流的并行程序。DAG最有价值的地方是构成了一个任务并行流的概念。

# 分布式缓存实现
## 一致性Hash算法
一致性hash算法最初由麻省理工学院在1997年提出，用于解决Internet网中的热点(Hotspot)问题，后来广泛用于分布式应用的负载均衡。一致性hash算法提出一个环的思想：服务器节点通过hash值key将环分成多个区域，存储的数据计算哈希值key后，按照顺时针方向存储到离它的key最近的服务器节点上去。
优点
- 数据服务器发生故障，只影响局部范围，整体容错性提升了。
- 集群扩容方便
缺点
- 当数据服务器key都互相挤在一起，容易出现多个数据key都落到同一台服务器上的情况，导致集群数据分布不均衡。
一致性算hash算法改进
- 为每个服务节点增加备份节点
- 优化计算服务器key，尽可能让key值平衡分布，不要靠太近
- 采用虚拟化手段将一台服务器物理机隔离成多个虚拟机，在形式上增加出多个服务器节点，维持分布平衡。
# 消息队列的实现
## JMS两种经典模式
- 点对点模式，一个生产者向特定的队列发布消息，一个消费者从中消费。
- 发布/订阅模式，生产者产生特定主体的消息，并发布，0个或多个消费者(订阅者)订阅并消费特定消息主题的消息。发布者和订阅者彼此不知道对方。
JMS规范定义主要对象角色如下：
1. 连接工厂(connectionFactory)，由管理员创建，并绑定到JNDI树中。客户端使用JNDI查找连接工厂，然后利用连接工厂创建一个JMS连接。
2. JMS连接(connection)，JMS客户端和服务器端之间的一个活动连接，是由客户端通过调用连接工厂创建的。
3. JMS会话(Session)表示JMS客户端和服务端之间的会话状态。JMS会话建立在JMS连接上，表示客户端和服务器之间的一个会话线程。
4. JMS目的（Destination），又称为消息队列，是实际的消息源。
5. JMS生产者消费者。生产者(Message Producer)、消费者(Message Consumer)对象由Session对象创建，用于发送和接收消息。

参考：
- [大规模分布式系统架构与设计实现.mobi(提取码: 8386)]( https://pan.baidu.com/s/1x91pu9cW2Qyy-w_NYXdQJQ)
